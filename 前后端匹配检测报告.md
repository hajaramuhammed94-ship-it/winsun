# ğŸ” Winsun å‰åç«¯åŒ¹é…æ£€æµ‹æŠ¥å‘Š

**æ£€æµ‹æ—¶é—´**: 2025-10-16  
**æ£€æµ‹äºº**: AI Assistant

---

## ğŸ“Š æ€»ä½“è¯„ä¼°

### âœ… åŒ¹é…çŠ¶æ€: **éƒ¨åˆ†åŒ¹é…ï¼Œéœ€è¦ä¿®å¤**

æ‚¨çš„å‰åç«¯é¡¹ç›®å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š
1. âš ï¸ **åç«¯ Vercel éƒ¨ç½²å¯èƒ½å¤±è´¥æˆ–æ— æ³•è®¿é—®**
2. âš ï¸ **å‰ç«¯é…ç½®çš„åç«¯ URL å¯èƒ½å·²è¿‡æœŸ**
3. âš ï¸ **CORS é…ç½®ä¸å®Œæ•´**
4. âš ï¸ **ç¯å¢ƒå˜é‡æœªæ­£ç¡®é…ç½®**

---

## ğŸŒ éƒ¨ç½²çŠ¶æ€æ£€æŸ¥

### å‰ç«¯éƒ¨ç½² (Vercel)

**é¡¹ç›®åç§°**: `winsun-original`  
**URL**: https://winsun-original.vercel.app  
**çŠ¶æ€**: âœ… åº”è¯¥æ­£å¸¸è¿è¡Œ

**é…ç½®æ–‡ä»¶**: `frontend/vercel.json`
```json
{
  "rewrites": [
    {
      "source": "/api/:path*",
      "destination": "https://winsun-backend-9ueb8wgwv-cvsgetyes-projects.vercel.app/api/:path*"
    }
  ]
}
```

### åç«¯éƒ¨ç½² (Vercel)

**é¡¹ç›®åç§°**: `winsun-backend`  
**URL**: https://winsun-backend.vercel.app  
**é…ç½®çš„URL**: https://winsun-backend-9ueb8wgwv-cvsgetyes-projects.vercel.app  
**çŠ¶æ€**: âš ï¸ **æ— æ³•è®¿é—® - è¿æ¥è¶…æ—¶**

**é—®é¢˜**: 
- åç«¯ URL å¯èƒ½å·²è¿‡æœŸï¼ˆVercel é¢„è§ˆéƒ¨ç½² URL ä¼šå˜åŒ–ï¼‰
- åç«¯å¯èƒ½éƒ¨ç½²å¤±è´¥
- åç«¯å¯èƒ½å·²è¢«åˆ é™¤

---

## ğŸ”§ é…ç½®åŒ¹é…åˆ†æ

### 1. API ç«¯ç‚¹é…ç½®

#### å‰ç«¯æœŸæœ›çš„ API ç«¯ç‚¹:
```javascript
// frontend/src/pages/Login.tsx
POST /api/auth/login
GET  /api/auth/me
GET  /api/signals/latest
```

#### åç«¯æä¾›çš„ API ç«¯ç‚¹:
```javascript
// backend/src/server.js
âœ… POST /api/auth/login
âœ… GET  /api/auth/me
âœ… GET  /api/signals/latest
âœ… GET  /api/health
âœ… WebSocket æ”¯æŒ
```

**ç»“è®º**: âœ… API ç«¯ç‚¹å®Œå…¨åŒ¹é…

---

### 2. CORS é…ç½®

#### åç«¯å½“å‰ CORS é…ç½®:
```javascript
// backend/src/server.js (ç¬¬27-30è¡Œ)
app.use(cors({
  origin: process.env.FRONTEND_URL || 'http://localhost:8080',
  credentials: true
}));
```

**é—®é¢˜**: âŒ **CORS é…ç½®ä¸å®Œæ•´**

- åªå…è®¸ `http://localhost:8080` æˆ–ç¯å¢ƒå˜é‡ä¸­çš„å•ä¸ªåŸŸå
- æ²¡æœ‰åŒ…å« Vercel å‰ç«¯åŸŸå
- æ²¡æœ‰åŒ…å«é€šé…ç¬¦æ”¯æŒå¤šä¸ª Vercel é¢„è§ˆéƒ¨ç½²

#### åº”è¯¥çš„é…ç½®:
```javascript
app.use(cors({
  origin: [
    'http://localhost:3000',
    'http://localhost:8080',
    'https://winsun-original.vercel.app',
    'https://winsun-original-*.vercel.app',  // æ”¯æŒé¢„è§ˆéƒ¨ç½²
    process.env.FRONTEND_URL
  ].filter(Boolean),
  credentials: true
}));
```

---

### 3. ç¯å¢ƒå˜é‡é…ç½®

#### åç«¯éœ€è¦çš„ç¯å¢ƒå˜é‡:
```env
PORT=5000
NODE_ENV=production
JWT_SECRET=your-secret-key
FRONTEND_URL=https://winsun-original.vercel.app
```

#### Vercel åç«¯å½“å‰é…ç½®:
```json
// backend/vercel.json
{
  "env": {
    "NODE_ENV": "production",
    "PORT": "5000"
  }
}
```

**é—®é¢˜**: âŒ **ç¼ºå°‘å…³é”®ç¯å¢ƒå˜é‡**
- ç¼ºå°‘ `JWT_SECRET`
- ç¼ºå°‘ `FRONTEND_URL`

---

### 4. å‰ç«¯ API è°ƒç”¨æ–¹å¼

#### React å‰ç«¯ (frontend/src):
```typescript
// ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œé€šè¿‡ Vercel rewrites ä»£ç†
axios.post('/api/auth/login', { email, password })
```

**é…ç½®**: âœ… æ­£ç¡® - ä½¿ç”¨ Vercel rewrites ä»£ç†

#### é™æ€å‰ç«¯ (frontend-static):
```javascript
// ç›´æ¥è°ƒç”¨åç«¯ URL
baseUrl: 'https://winsun-backend-9ueb8wgwv-cvsgetyes-projects.vercel.app'
```

**é—®é¢˜**: âš ï¸ **URL å¯èƒ½å·²è¿‡æœŸ**

---

## ğŸš¨ å‘ç°çš„é—®é¢˜

### é—®é¢˜ 1: åç«¯ URL æ— æ³•è®¿é—® âš ï¸âš ï¸âš ï¸

**ä¸¥é‡ç¨‹åº¦**: ğŸ”´ é«˜

**æè¿°**: 
- å‰ç«¯é…ç½®çš„åç«¯ URL `https://winsun-backend-9ueb8wgwv-cvsgetyes-projects.vercel.app` æ— æ³•è®¿é—®
- è¿™æ˜¯ä¸€ä¸ª Vercel é¢„è§ˆéƒ¨ç½² URLï¼Œå¯èƒ½å·²è¿‡æœŸ

**å½±å“**:
- å‰ç«¯æ— æ³•è¿æ¥åç«¯
- æ‰€æœ‰ API è¯·æ±‚éƒ½ä¼šå¤±è´¥
- ç”¨æˆ·æ— æ³•ç™»å½•

**è§£å†³æ–¹æ¡ˆ**: è§ä¸‹æ–¹ä¿®å¤æ­¥éª¤

---

### é—®é¢˜ 2: CORS é…ç½®ä¸å®Œæ•´ âš ï¸

**ä¸¥é‡ç¨‹åº¦**: ğŸŸ¡ ä¸­

**æè¿°**: 
- åç«¯åªå…è®¸ `localhost:8080` è®¿é—®
- æ²¡æœ‰åŒ…å« Vercel å‰ç«¯åŸŸå

**å½±å“**:
- å³ä½¿åç«¯å¯è®¿é—®ï¼Œå‰ç«¯è¯·æ±‚ä¹Ÿä¼šè¢« CORS é˜»æ­¢

**è§£å†³æ–¹æ¡ˆ**: è§ä¸‹æ–¹ä¿®å¤æ­¥éª¤

---

### é—®é¢˜ 3: ç¯å¢ƒå˜é‡ç¼ºå¤± âš ï¸

**ä¸¥é‡ç¨‹åº¦**: ğŸŸ¡ ä¸­

**æè¿°**: 
- Vercel åç«¯ç¼ºå°‘ `JWT_SECRET` å’Œ `FRONTEND_URL`

**å½±å“**:
- JWT è®¤è¯å¯èƒ½ä½¿ç”¨é»˜è®¤å€¼ï¼ˆä¸å®‰å…¨ï¼‰
- CORS é…ç½®æ— æ³•æ­£ç¡®å·¥ä½œ

**è§£å†³æ–¹æ¡ˆ**: è§ä¸‹æ–¹ä¿®å¤æ­¥éª¤

---

## ğŸ”§ ä¿®å¤æ­¥éª¤

### æ­¥éª¤ 1: é‡æ–°éƒ¨ç½²åç«¯åˆ° Vercel

```bash
cd /home/jzy/æ¡Œé¢/é‡åŒ–/winsun-clone/backend

# éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒï¼ˆè·å–ç¨³å®šçš„ URLï¼‰
npx vercel --prod
```

**é‡è¦**: 
- ä½¿ç”¨ `--prod` æ ‡å¿—éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
- è®°å½•æ–°çš„ç”Ÿäº§ URLï¼ˆä¾‹å¦‚: `https://winsun-backend.vercel.app`ï¼‰

---

### æ­¥éª¤ 2: åœ¨ Vercel æ§åˆ¶å°é…ç½®ç¯å¢ƒå˜é‡

1. è®¿é—®: https://vercel.com/cvsgetyes-projects/winsun-backend/settings/environment-variables

2. æ·»åŠ ä»¥ä¸‹ç¯å¢ƒå˜é‡:

| å˜é‡å | å€¼ | ç¯å¢ƒ |
|--------|-----|------|
| `JWT_SECRET` | `your-super-secret-jwt-key-change-this` | Production, Preview, Development |
| `FRONTEND_URL` | `https://winsun-original.vercel.app` | Production |
| `NODE_ENV` | `production` | Production |

3. ç‚¹å‡» "Save"

4. é‡æ–°éƒ¨ç½²åç«¯ï¼ˆVercel ä¼šè‡ªåŠ¨è§¦å‘ï¼‰

---

### æ­¥éª¤ 3: æ›´æ–°åç«¯ CORS é…ç½®

ç¼–è¾‘ `backend/src/server.js`:

```javascript
// ä¿®æ”¹ç¬¬ 27-30 è¡Œ
app.use(cors({
  origin: function (origin, callback) {
    const allowedOrigins = [
      'http://localhost:3000',
      'http://localhost:8080',
      'https://winsun-original.vercel.app',
      process.env.FRONTEND_URL
    ];
    
    // å…è®¸ Vercel é¢„è§ˆéƒ¨ç½²
    if (!origin || allowedOrigins.includes(origin) || 
        origin.match(/https:\/\/winsun-original-.*\.vercel\.app$/)) {
      callback(null, true);
    } else {
      callback(new Error('Not allowed by CORS'));
    }
  },
  credentials: true
}));

// åŒæ ·æ›´æ–° Socket.IO CORS (ç¬¬ 18-24 è¡Œ)
const io = socketIO(server, {
  cors: {
    origin: function (origin, callback) {
      const allowedOrigins = [
        'http://localhost:3000',
        'http://localhost:8080',
        'https://winsun-original.vercel.app',
        process.env.FRONTEND_URL
      ];
      
      if (!origin || allowedOrigins.includes(origin) || 
          origin.match(/https:\/\/winsun-original-.*\.vercel\.app$/)) {
        callback(null, true);
      } else {
        callback(new Error('Not allowed by CORS'));
      }
    },
    methods: ['GET', 'POST'],
    credentials: true
  }
});
```

---

### æ­¥éª¤ 4: æ›´æ–°å‰ç«¯é…ç½®

#### 4.1 æ›´æ–° React å‰ç«¯

ç¼–è¾‘ `frontend/vercel.json`:

```json
{
  "version": 2,
  "buildCommand": "npm run build",
  "outputDirectory": "dist",
  "framework": "vite",
  "rewrites": [
    {
      "source": "/api/:path*",
      "destination": "https://winsun-backend.vercel.app/api/:path*"
    },
    {
      "source": "/(.*)",
      "destination": "/index.html"
    }
  ]
}
```

**æ³¨æ„**: å°† URL æ”¹ä¸ºæ­¥éª¤ 1 ä¸­è·å–çš„ç”Ÿäº§ URL

#### 4.2 æ›´æ–°é™æ€å‰ç«¯

ç¼–è¾‘ `frontend-static/client/config.js`:

```javascript
DEPLOYED: {
    baseUrl: 'https://winsun-backend.vercel.app',  // æ”¹ä¸ºæ–°çš„ç”Ÿäº§ URL
    endpoints: {
        login: '/api/auth/login',
        register: '/api/auth/register',
        profile: '/api/auth/profile'
    },
    method: 'POST',
    passwordEncryption: 'BCRYPT',
    responseFormat: 'JWT'
}
```

---

### æ­¥éª¤ 5: é‡æ–°éƒ¨ç½²å‰ç«¯

```bash
cd /home/jzy/æ¡Œé¢/é‡åŒ–/winsun-clone/frontend

# é‡æ–°éƒ¨ç½²
npx vercel --prod
```

---

## âœ… éªŒè¯æ­¥éª¤

### 1. æµ‹è¯•åç«¯å¥åº·æ£€æŸ¥

```bash
curl https://winsun-backend.vercel.app/api/health
```

**æœŸæœ›è¾“å‡º**:
```json
{
  "status": "ok",
  "message": "Winsun API is running",
  "timestamp": "2025-10-16T..."
}
```

### 2. æµ‹è¯•å‰ç«¯è®¿é—®

è®¿é—®: https://winsun-original.vercel.app

### 3. æµ‹è¯•ç™»å½•åŠŸèƒ½

1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· (F12)
2. è®¿é—®ç™»å½•é¡µé¢
3. è¾“å…¥æµ‹è¯•è´¦å·:
   - é‚®ç®±: `12345@qq.com`
   - å¯†ç : `123456`
4. æ£€æŸ¥ Network æ ‡ç­¾ï¼Œç¡®è®¤:
   - API è¯·æ±‚æˆåŠŸ (çŠ¶æ€ç  200)
   - æ²¡æœ‰ CORS é”™è¯¯

---

## ğŸ“‹ æ£€æŸ¥æ¸…å•

å®Œæˆä¿®å¤åï¼Œè¯·ç¡®è®¤ä»¥ä¸‹é¡¹ç›®:

- [ ] åç«¯å·²é‡æ–°éƒ¨ç½²åˆ° Vercel ç”Ÿäº§ç¯å¢ƒ
- [ ] è·å–äº†ç¨³å®šçš„åç«¯ç”Ÿäº§ URL
- [ ] åœ¨ Vercel æ§åˆ¶å°é…ç½®äº†æ‰€æœ‰ç¯å¢ƒå˜é‡
- [ ] æ›´æ–°äº†åç«¯ CORS é…ç½®
- [ ] æ›´æ–°äº†å‰ç«¯ vercel.json ä¸­çš„åç«¯ URL
- [ ] æ›´æ–°äº† frontend-static/client/config.js ä¸­çš„åç«¯ URL
- [ ] é‡æ–°éƒ¨ç½²äº†å‰ç«¯
- [ ] æµ‹è¯•äº†åç«¯å¥åº·æ£€æŸ¥ç«¯ç‚¹
- [ ] æµ‹è¯•äº†å‰ç«¯ç™»å½•åŠŸèƒ½
- [ ] æ£€æŸ¥äº†æµè§ˆå™¨æ§åˆ¶å°æ²¡æœ‰ CORS é”™è¯¯

---

## ğŸ¯ å¿«é€Ÿä¿®å¤å‘½ä»¤

å¦‚æœæ‚¨æƒ³å¿«é€Ÿæ‰§è¡Œæ‰€æœ‰ä¿®å¤ï¼Œå¯ä»¥æŒ‰é¡ºåºè¿è¡Œä»¥ä¸‹å‘½ä»¤:

```bash
# 1. éƒ¨ç½²åç«¯
cd /home/jzy/æ¡Œé¢/é‡åŒ–/winsun-clone/backend
npx vercel --prod
# è®°å½•è¾“å‡ºçš„ URL

# 2. æµ‹è¯•åç«¯
curl https://winsun-backend.vercel.app/api/health

# 3. éƒ¨ç½²å‰ç«¯
cd /home/jzy/æ¡Œé¢/é‡åŒ–/winsun-clone/frontend
npx vercel --prod

# 4. æµ‹è¯•å‰ç«¯
curl -I https://winsun-original.vercel.app
```

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯:

1. åç«¯éƒ¨ç½²çš„å®Œæ•´ URL
2. å‰ç«¯éƒ¨ç½²çš„å®Œæ•´ URL
3. æµè§ˆå™¨æ§åˆ¶å°çš„é”™è¯¯ä¿¡æ¯
4. Vercel éƒ¨ç½²æ—¥å¿—

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-10-16  
**ä¸‹æ¬¡æ£€æŸ¥å»ºè®®**: ä¿®å¤å®Œæˆå

